<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù…ØªØ¬Ø±ÙŠ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠ</title>
  <style>
    body {
      font-family: 'Arial';
      background: #f4f4f4;
      padding: 30px;
      color: #333;
    }
    h1, h2 {
      color: #007BFF;
    }
    .product {
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      margin-bottom: 15px;
      display: flex;
      gap: 20px;
      padding: 15px;
      align-items: center;
    }
    .product img {
      width: 120px;
      height: 120px;
      object-fit: cover;
      border-radius: 8px;
    }
    .product h3 {
      margin: 5px 0;
    }
    .product p {
      margin: 5px 0;
    }
    .product button {
      padding: 5px 10px;
      background: #28a745;
      border: none;
      color: white;
      cursor: pointer;
      border-radius: 5px;
    }
    .cart-item {
      background: #fff;
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 10px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .cart-item input {
      width: 50px;
    }
    .cart-item button {
      margin-left: 5px;
      padding: 3px 8px;
    }
  </style>
</head>
<body>

<h1>ğŸ›ï¸ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h1>
<div id="products"></div>

<h2>ğŸ›’ Ø§Ù„Ø³Ù„Ø©</h2>
<div id="cart">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</div>

<h2>ğŸ“¦ ØªÙ†ÙÙŠØ° Ø§Ù„Ø·Ù„Ø¨</h2>
<form id="orderForm" action="https://formsubmit.co/cherif14200@gmail.com" method="POST">
  <input type="hidden" name="_subject" value="Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…ØªØ¬Ø± ">
  <input type="hidden" name="_captcha" value="false">
  <input type="hidden" name="cart" id="cartData">
  <input type="hidden" name="total" id="cartTotal">

  <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„: <input type="text" name="name" required></label><br><br>
  <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ: <input type="tel" name="phone" required></label><br><br>
  <label>Ø§Ù„ÙˆÙ„Ø§ÙŠØ©:
    <select id="wilaya" name="wilaya" required>
      <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ„Ø§ÙŠØ©</option>
    </select>
  </label><br><br>
  <label>Ø§Ù„Ø¨Ù„Ø¯ÙŠØ©:
    <select id="commune" name="commune" required>
      <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù„Ø¯ÙŠØ©</option>
    </select>
  </label><br><br>
  <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ§Ù…Ù„: <input type="text" name="address" required></label><br><br>

  <p id="shippingCostText">Ø³Ø¹Ø± Ø§Ù„ØªÙˆØµÙŠÙ„: 0 Ø¯Ø¬</p>
  <p id="finalTotalText">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: 0 Ø¯Ø¬</p>

  <button type="submit">âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
</form>

<script>
const PRODUCTS_URL = "https://script.google.com/macros/s/AKfycbwAYiOFNt4eGtmSclHWBSJaMwMhSzois2-BP_uchEVhoBs7ga_CB67qi1uz_lGUgVay/exec";
let cart = [];

const shippingCosts = {"ØªÙŠØ§Ø±Øª": 600, "Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±": 400, "ÙˆÙ‡Ø±Ø§Ù†": 500};

function updateFinalTotal() {
  const wilaya = document.getElementById('wilaya').value;
  const shipping = shippingCosts[wilaya] || 0;
  const subtotal = cart.reduce((sum, item) => sum + item.price * item.qty, 0);
  const total = subtotal + shipping;

  document.getElementById('shippingCostText').innerText = `Ø³Ø¹Ø± Ø§Ù„ØªÙˆØµÙŠÙ„: ${shipping} Ø¯Ø¬`;
  document.getElementById('finalTotalText').innerText = `Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ${total} Ø¯Ø¬`;

  document.getElementById('cartTotal').value = total;
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
fetch(PRODUCTS_URL)
  .then(res => res.json())
  .then(products => {
    const container = document.getElementById('products');
    products.forEach(p => {
      if (parseInt(p.quantity) > 0) {
        const div = document.createElement('div');
        div.className = 'product';
        div.innerHTML = `
          <img src="${p.image}" alt="${p.name}" />
          <div>
            <h3>${p.name}</h3>
            <p>${p.description}</p>
            <p><strong>${p.price} Ø¯Ø¬</strong></p>
            <label>Ø§Ù„ÙƒÙ…ÙŠØ©: <input type="number" min="1" value="1" id="qty-${p.name}" /></label>
            <button onclick='addToCart(${JSON.stringify(p)}, "${p.name}")'>Ø£Ø¶Ù Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©</button>
          </div>`;
        container.appendChild(div);
      }
    });
  });

function addToCart(product, name) {
  const qty = parseInt(document.getElementById(`qty-${name}`).value) || 1;
  const existing = cart.find(p => p.name === product.name);
  if (existing) {
    existing.qty += qty;
  } else {
    cart.push({ ...product, qty });
  }
  showCart();
}

function showCart() {
  const cartBox = document.getElementById('cart');
  if (cart.length === 0) {
    cartBox.innerHTML = "Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©";
    return;
  }

  cartBox.innerHTML = cart.map((item, index) => `
    <div class="cart-item">
      <p><strong>${item.name}</strong> - ${item.price} Ø¯Ø¬ Ã— ${item.qty} = ${item.price * item.qty} Ø¯Ø¬</p>
      <button onclick="removeItem(${index})">ğŸ—‘ï¸ Ø­Ø°Ù</button>
      <button onclick="editItem(${index})">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
    </div>
  `).join("");

  updateFinalTotal();
}

function removeItem(index) {
  cart.splice(index, 1);
  showCart();
}

function editItem(index) {
  const newQty = prompt("Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:", cart[index].qty);
  if (newQty && !isNaN(newQty) && newQty > 0) {
    cart[index].qty = parseInt(newQty);
    showCart();
  }
}

// ÙˆÙ„Ø§ÙŠØ§Øª ÙˆØ¨Ù„Ø¯ÙŠØ§Øª
const dzData = {
  "ØªÙŠØ§Ø±Øª": ["ÙØ±Ù†Ø¯Ø©", "Ù…Ù‡Ø¯ÙŠØ©", "Ù‚ØµØ± Ø§Ù„Ø´Ù„Ø§Ù„Ø©", "Ù…Ø¯Ø±ÙˆØ³Ø©"],
  "Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±": ["Ø¨Ø§Ø¨ Ø§Ù„Ø²ÙˆØ§Ø±", "Ø­ÙŠØ¯Ø±Ø©", "Ø¨Ø¦Ø± Ù…Ø±Ø§Ø¯ Ø±Ø§ÙŠØ³", "Ø¨Ù„ÙˆØ²Ø¯Ø§Ø¯"],
  "ÙˆÙ‡Ø±Ø§Ù†": ["Ø§Ù„Ø³Ø§Ù†ÙŠØ©", "Ø¨Ø¦Ø± Ø§Ù„Ø¬ÙŠØ±", "Ø¨Ø·ÙŠÙˆØ©", "Ø§Ù„ÙƒØ±Ù…Ø©"]
};

const wilayaSelect = document.getElementById('wilaya');
const communeSelect = document.getElementById('commune');

for (let wilaya in dzData) {
  let option = document.createElement('option');
  option.value = wilaya;
  option.textContent = wilaya;
  wilayaSelect.appendChild(option);
}

wilayaSelect.addEventListener('change', () => {
  communeSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù„Ø¯ÙŠØ©</option>';
  const selected = dzData[wilayaSelect.value] || [];
  selected.forEach(commune => {
    let opt = document.createElement('option');
    opt.value = commune;
    opt.textContent = commune;
    communeSelect.appendChild(opt);
  });
  updateFinalTotal();
});

// ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø³Ù„Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
document.getElementById('orderForm').addEventListener('submit', function(e) {
  if (cart.length === 0) {
    e.preventDefault();
    alert("âŒ Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©!");
    return;
  }

  document.getElementById('cartData').value =
    cart.map(p => `${p.name} (${p.price} Ø¯Ø¬ Ã— ${p.qty}) = ${p.price * p.qty} Ø¯Ø¬`).join(" - ");
});
</script>

</body>
  </html>

