<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù…ØªØ¬Ø±ÙŠ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠ</title>
  <style>
    /* ... Ù†ÙØ³ Ø§Ù„Ø³ØªØ§ÙŠÙ„Ø§Øª ØªÙ…Ø§Ù…Ø§Ù‹ØŒ Ù„Ø§ ØªØºÙŠÙŠØ± Ù‡Ù†Ø§ ... */
    body { font-family: 'Tahoma', 'Arial', sans-serif; padding: 20px; background: #f4f4f9; color: #333; }
    h1, h2 { text-align: center; color: #0056b3; }
    .products-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
    .product { border: 1px solid #ddd; border-radius: 8px; padding: 15px; background: white; display: flex; flex-direction: column; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); transition: transform 0.2s; }
    .product:hover { transform: translateY(-5px); }
    .product img { max-width: 100%; height: 200px; object-fit: cover; border-radius: 5px; margin-bottom: 15px; }
    .product-info { flex-grow: 1; }
    .product-price { font-size: 1.2em; font-weight: bold; color: #28a745; margin: 10px 0; }
    .add-to-cart-btn { background-color: #007bff; color: white; border: none; padding: 10px 15px; cursor: pointer; border-radius: 5px; width: 100%; font-size: 1em; transition: background-color 0.2s; }
    .add-to-cart-btn:hover { background-color: #0056b3; }
    #cart, #orderForm { margin-top: 30px; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .cart-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    .cart-table th, .cart-table td { border: 1px solid #ddd; padding: 10px; text-align: center; vertical-align: middle; }
    .cart-table th { background-color: #f2f2f2; }
    .quantity-input { width: 60px; text-align: center; padding: 5px; border: 1px solid #ccc; border-radius: 4px; }
    .remove-btn { background: #dc3545; color: white; border: none; padding: 5px 10px; cursor: pointer; border-radius: 4px; }
    form label { display: block; margin-bottom: 10px; }
    form input, form select { width: 100%; padding: 8px; margin-top: 5px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; }
    form button { background-color: #28a745; color: white; padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 1.1em; width: 100%; }
    form button:disabled { background-color: #aaa; cursor: not-allowed; }
    .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); }
    .modal-content { background-color: #fefefe; margin: 10% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 600px; border-radius: 10px; position: relative; }
    .close-btn { color: #aaa; position: absolute; left: 15px; top: 5px; font-size: 28px; font-weight: bold; cursor: pointer; }
    .close-btn:hover, .close-btn:focus { color: black; }
    .modal-buttons { display: flex; justify-content: space-between; margin-top: 20px; }
    .modal-buttons button { width: 48%; }
    #confirm-order-btn { background-color: #28a745; }
    #cancel-order-btn { background-color: #6c757d; }
  </style>
</head>
<body>

<h1>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ØªÙˆÙØ±Ø©</h1>
<div id="products-container" class="products-container"></div>

<h2>ğŸ›’ Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h2>
<div id="cart"><p>Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ© Ø­Ø§Ù„ÙŠØ§Ù‹.</p></div>

<h2>ğŸ“¦ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø­Ù† ÙˆØ§Ù„ØªÙˆØµÙŠÙ„</h2>
<!-- **ØªØ¹Ø¯ÙŠÙ„ Ù…Ù‡Ù…**: Ø£Ø¶ÙÙ†Ø§ Ø­Ù‚Ù„ _next Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø¹Ø¯ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙÙˆØ±Ù… -->
<form id="orderForm" action="https://formsubmit.co/cherif14200@gmail.com" method="POST">
  <input type="hidden" name="_subject" value="Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…ØªØ¬Ø±">
  <input type="hidden" name="_captcha" value="false">
  <input type="hidden" name="_next" value="https://your-website.com/index2.htmlthankyou.html"> <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ø§Ø­Ù‚Ø§Ù‹ -->

  <input type="hidden" name="cart_items" id="cartData">
  <input type="hidden" name="delivery_cost" id="deliveryCost">
  <input type="hidden" name="final_total_price" id="cartTotal">

  <label for="name">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„:</label>
  <input type="text" id="name" name="name" required>

  <label for="phone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</label>
  <input type="tel" id="phone" name="phone" required>

  <label for="wilaya">Ø§Ù„ÙˆÙ„Ø§ÙŠØ©:</label>
  <select id="wilaya" name="wilaya" required><option value="">Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ„Ø§ÙŠØ©...</option></select>

  <label for="commune">Ø§Ù„Ø¨Ù„Ø¯ÙŠØ©:</label>
  <select id="commune" name="commune" required><option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù„Ø¯ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹...</option></select>

  <label for="address">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ§Ù…Ù„ (Ø§Ù„Ø­ÙŠØŒ Ø§Ù„Ø´Ø§Ø±Ø¹ØŒ Ø¥Ù„Ø®):</label>
  <input type="text" id="address" name="address" required>

  <button type="submit" id="submitBtn">Ø¥ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø´Ø±Ø§Ø¡</button>
</form>

<!-- ===== Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© (Modal) ===== -->
<div id="confirmationModal" class="modal">
  <div class="modal-content">
    <span class="close-btn">Ã—</span>
    <h2>ğŸ“ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨</h2>
    <div id="confirmation-summary"></div>
    <div class="modal-buttons">
        <button id="cancel-order-btn">Ø¥Ù„ØºØ§Ø¡</button>
        <button id="confirm-order-btn">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
    </div>
  </div>
</div>

<script>
const PRODUCTS_URL = "https://script.google.com/macros/s/AKfycbwAYiOFNt4eGtmSclHWBSJaMwMhSzois2-BP_uchEVhoBs7ga_CB67qi1uz_lGUgVay/exec";
const DZ_DATA_URL = "dz.json";
const DELIVERY_COSTS = {
  "Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±": 400, "ÙˆÙ‡Ø±Ø§Ù†": 450, "Ù‚Ø³Ù†Ø·ÙŠÙ†Ø©": 450, "Ø§Ù„Ø¨Ù„ÙŠØ¯Ø©": 350, "Ø¨ÙˆÙ…Ø±Ø¯Ø§Ø³": 350, "ØªÙŠØ¨Ø§Ø²Ø©": 350,
  "default": 600
};

let cart = [];
let dzData = {};

document.addEventListener('DOMContentLoaded', () => {
    // **ØªØ¹Ø¯ÙŠÙ„ Ù…Ù‡Ù…**: ØªØ­Ø¯ÙŠØ¯ Ø±Ø§Ø¨Ø· ØµÙØ­Ø© Ø§Ù„Ø´ÙƒØ± Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹
    const thankYouPageUrl = window.location.origin + window.location.pathname.replace('index.html', '') + 'thankyou.html';
    document.querySelector('input[name="_next"]').value = thankYouPageUrl;
    
    loadProducts();
    loadWilayas();
    renderCart();
});

const wilayaSelect = document.getElementById('wilaya');
const communeSelect = document.getElementById('commune');
const orderForm = document.getElementById('orderForm');
const modal = document.getElementById('confirmationModal');
const closeBtn = document.querySelector('.close-btn');
const confirmBtn = document.getElementById('confirm-order-btn');
const cancelBtn = document.getElementById('cancel-order-btn');

function loadProducts() { /* ... Ù†ÙØ³ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± ... */
  fetch(PRODUCTS_URL).then(res => res.json()).then(displayProducts).catch(err => {
    document.getElementById('products-container').innerHTML = '<p>Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª.</p>'; console.error(err);
  });
}

function loadWilayas() { /* ... Ù†ÙØ³ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± ... */
  fetch(DZ_DATA_URL).then(res => res.json()).then(data => {
    dzData = data;
    Object.keys(dzData).sort().forEach(wilaya => wilayaSelect.appendChild(new Option(wilaya, wilaya)));
  }).catch(err => { console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª:", err); alert("Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª ÙˆØ§Ù„Ø¨Ù„Ø¯ÙŠØ§Øª."); });
}

function displayProducts(products) { /* ... Ù†ÙØ³ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± ... */
  const container = document.getElementById('products-container');
  container.innerHTML = '';
  products.forEach(p => {
    if (p.id && parseInt(p.quantity) > 0) {
      const div = document.createElement('div');
      div.className = 'product';
      div.innerHTML = `<img src="${p.image}" alt="${p.name}" /><div class="product-info"><h3>${p.name}</h3><p>${p.description}</p><p class="product-price">${p.price} Ø¯Ø¬</p></div><button class="add-to-cart-btn" onclick='addToCart(${JSON.stringify(p)})'>Ø£Ø¶Ù Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©</button>`;
      container.appendChild(div);
    }
  });
}

function addToCart(product) { /* ... Ù†ÙØ³ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± ... */
  const existingProduct = cart.find(item => item.id == product.id);
  if (existingProduct) { existingProduct.quantity++; } else { cart.push({ ...product, quantity: 1 }); }
  alert(`ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© "${product.name}" Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!`);
  renderCart();
}

function removeFromCart(productId) {
  cart = cart.filter(item => item.id != productId);
  renderCart();
}

// **Ø¥ØµÙ„Ø§Ø­**: ØªØ¹Ø¯ÙŠÙ„ Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙ…ÙŠØ© Ù„ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
function updateQuantity(productId, newQuantity) {
  const product = cart.find(item => item.id == productId); // Ø§Ø³ØªØ®Ø¯Ø§Ù… '==' Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø© ØºÙŠØ± Ø§Ù„ØµØ§Ø±Ù…Ø© (Ù†Øµ Ù…Ø¹ Ø±Ù‚Ù…)
  if (product) {
    product.quantity = Math.max(1, newQuantity); // Ø§Ù„ÙƒÙ…ÙŠØ© Ù„Ø§ ØªÙ‚Ù„ Ø¹Ù† 1
  }
  renderCart();
}

function renderCart() { /* ... Ù†ÙØ³ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± ... */
  const cartContainer = document.getElementById('cart');
  if (cart.length === 0) { cartContainer.innerHTML = "<p>Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ© Ø­Ø§Ù„ÙŠØ§Ù‹.</p>"; return; }

  const cartSubtotal = cart.reduce((sum, item) => sum + (parseFloat(item.price) * item.quantity), 0);
  const selectedWilaya = wilayaSelect.value;
  const deliveryCost = selectedWilaya ? (DELIVERY_COSTS[selectedWilaya] || DELIVERY_COSTS.default) : 0;
  const finalTotal = cartSubtotal + deliveryCost;

  // **ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø³ÙŠØ·**: ØªÙ…Ø±ÙŠØ± Ø§Ù„Ù€ id Ø§Ù„Ù…Ù†ØªØ¬ Ù„Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ«
  const cartItemsHtml = cart.map(item => {
    const itemTotal = parseFloat(item.price) * item.quantity;
    return `<tr><td>${item.name}</td><td>${item.price} Ø¯Ø¬</td><td><input type="number" class="quantity-input" value="${item.quantity}" min="1" onchange="updateQuantity('${item.id}', this.valueAsNumber)"></td><td>${itemTotal.toFixed(2)} Ø¯Ø¬</td><td><button class="remove-btn" onclick="removeFromCart('${item.id}')">Ø­Ø°Ù</button></td></tr>`;
  }).join('');

  cartContainer.innerHTML = `<table class="cart-table"><thead><tr><th>Ø§Ù„Ù…Ù†ØªØ¬</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead><tbody>${cartItemsHtml}</tbody><tfoot><tr><td colspan="4">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ</td><td><strong>${cartSubtotal.toFixed(2)} Ø¯Ø¬</strong></td></tr><tr><td colspan="4">ØªÙƒÙ„ÙØ© Ø§Ù„ØªÙˆØµÙŠÙ„ (${selectedWilaya || 'Ø§Ø®ØªØ± ÙˆÙ„Ø§ÙŠØ©'})</td><td><strong>${deliveryCost.toFixed(2)} Ø¯Ø¬</strong></td></tr><tr style="background-color:#e9f5e9;"><td colspan="4"><strong>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ</strong></td><td><strong>${finalTotal.toFixed(2)} Ø¯Ø¬</strong></td></tr></tfoot></table>`;
}

wilayaSelect.addEventListener('change', () => { /* ... Ù†ÙØ³ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± ... */
  communeSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù„Ø¯ÙŠØ©...</option>';
  const selectedWilaya = wilayaSelect.value;
  if (selectedWilaya && dzData[selectedWilaya]) {
    dzData[selectedWilaya].forEach(commune => communeSelect.appendChild(new Option(commune, commune)));
  }
  renderCart();
});

orderForm.addEventListener('submit', function(e) { /* ... Ù†ÙØ³ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± ... */
  e.preventDefault();
  if (cart.length === 0) { alert("âŒ Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©!"); return; }
  if (!orderForm.checkValidity()) { alert("âŒ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©."); orderForm.reportValidity(); return; }
  showConfirmationModal();
});

function showConfirmationModal() { /* ... Ù†ÙØ³ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± ... */
  const summaryContainer = document.getElementById('confirmation-summary');
  const name = document.getElementById('name').value, phone = document.getElementById('phone').value, wilaya = document.getElementById('wilaya').value, commune = document.getElementById('commune').value, address = document.getElementById('address').value;
  const cartSubtotal = cart.reduce((sum, item) => sum + (parseFloat(item.price) * item.quantity), 0);
  const deliveryCost = DELIVERY_COSTS[wilaya] || DELIVERY_COSTS.default;
  const finalTotal = cartSubtotal + deliveryCost;
  const itemsList = cart.map(item => `<li>${item.name} (Ø§Ù„ÙƒÙ…ÙŠØ©: ${item.quantity}) - ${item.price} Ø¯Ø¬</li>`).join('');

  summaryContainer.innerHTML = `<h4>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:</h4><ul>${itemsList}</ul><hr><p><strong>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ:</strong> ${cartSubtotal.toFixed(2)} Ø¯Ø¬</p><p><strong>ØªÙƒÙ„ÙØ© Ø§Ù„ØªÙˆØµÙŠÙ„:</strong> ${deliveryCost.toFixed(2)} Ø¯Ø¬</p><h3><strong>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ${finalTotal.toFixed(2)} Ø¯Ø¬</strong></h3><hr><h4>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„:</h4><p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${name}</p><p><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${phone}</p><p><strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${address}, ${commune}, ${wilaya}</p>`;
  document.getElementById('cartData').value = cart.map(p => `${p.name} (x${p.quantity})`).join(" | ");
  document.getElementById('deliveryCost').value = `${deliveryCost.toFixed(2)} Ø¯Ø¬`;
  document.getElementById('cartTotal').value = `${finalTotal.toFixed(2)} Ø¯Ø¬`;
  modal.style.display = 'block';
}

closeBtn.onclick = () => { modal.style.display = 'none'; };
cancelBtn.onclick = () => { modal.style.display = 'none'; };
window.onclick = (event) => { if (event.target == modal) { modal.style.display = 'none'; } };
confirmBtn.onclick = () => {
  confirmBtn.disabled = true;
  confirmBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';
  orderForm.submit();
};
</script>

</body>
</html>

</body>
  </html>

