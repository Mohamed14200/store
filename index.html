<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>متجري الجزائري</title>
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      margin: 0;
      background: #f0f2f5;
      color: #333;
    }

    header {
      background-color: #007BFF;
      color: white;
      padding: 20px 30px;
      text-align: center;
      font-size: 28px;
      font-weight: bold;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    main {
      padding: 30px;
      max-width: 1000px;
      margin: auto;
    }

    h2 {
      border-bottom: 2px solid #007BFF;
      padding-bottom: 5px;
      margin-top: 40px;
      font-size: 24px;
      color: #007BFF;
    }

    .product {
      background: white;
      display: flex;
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      transition: transform 0.2s ease;
    }

    .product:hover {
      transform: scale(1.01);
    }

    .product img {
      width: 150px;
      height: 150px;
      object-fit: cover;
      border-left: 1px solid #eee;
    }

    .product-content {
      padding: 15px;
      flex-grow: 1;
    }

    .product-content h3 {
      margin: 0 0 10px;
      color: #333;
    }

    .product-content p {
      margin: 5px 0;
      line-height: 1.5;
    }

    .product-content strong {
      display: block;
      color: #28a745;
      margin: 10px 0;
    }

    .product-content button {
      padding: 8px 16px;
      border: none;
      background: #007BFF;
      color: white;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
    }

    .product-content button:hover {
      background: #0056b3;
    }

    #cart {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      margin-top: 10px;
    }

    #orderForm {
      background: white;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    label {
      display: block;
      margin-bottom: 10px;
      font-weight: bold;
    }

    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border-radius: 5px;
      border: 1px solid #ccc;
      font-size: 16px;
    }

    button[type="submit"] {
      margin-top: 20px;
      padding: 12px 24px;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 18px;
      cursor: pointer;
    }

    button[type="submit"]:hover {
      background: #218838;
    }

    .cart-item {
      margin-bottom: 10px;
      border-bottom: 1px dashed #ccc;
      padding-bottom: 5px;
    }
  </style>
</head>
<body>

<header>🛍️ متجري الجزائري</header>

<main>
  <h2>📦 المنتجات</h2>
  <div id="products"></div>

  <h2>🛒 السلة</h2>
  <div id="cart">السلة فارغة</div>

  <h2>📤 تنفيذ الطلب</h2>
  <form id="orderForm" action="https://formsubmit.co/cherif14200@gmail.com" method="POST">
    <input type="hidden" name="_subject" value="طلب جديد من المتجر">
    <input type="hidden" name="_captcha" value="false">
    <input type="hidden" name="cart" id="cartData">
    <input type="hidden" name="total" id="cartTotal">

    <label>الاسم الكامل:
      <input type="text" name="name" required>
    </label>

    <label>رقم الهاتف:
      <input type="tel" name="phone" required>
    </label>

    <label>الولاية:
      <select id="wilaya" name="wilaya" required>
        <option value="">اختر الولاية</option>
      </select>
    </label>

    <label>البلدية:
      <select id="commune" name="commune" required>
        <option value="">اختر البلدية</option>
      </select>
    </label>

    <label>العنوان الكامل:
      <input type="text" name="address" required>
    </label>

    <button type="submit">✅ إرسال الطلب</button>
  </form>
</main>

<script>
const PRODUCTS_URL = "https://script.google.com/macros/s/AKfycbwAYiOFNt4eGtmSclHWBSJaMwMhSzois2-BP_uchEVhoBs7ga_CB67qi1uz_lGUgVay/exec";
let cart = [];

fetch(PRODUCTS_URL)
  .then(res => res.json())
  .then(products => {
    const container = document.getElementById('products');
    products.forEach(p => {
      if (parseInt(p.quantity) > 0) {
        const div = document.createElement('div');
        div.className = 'product';
        div.innerHTML = `
          <img src="${p.image}" alt="${p.name}" />
          <div class="product-content">
            <h3>${p.name}</h3>
            <p>${p.description}</p>
            <strong>${p.price} دج</strong>
            <button onclick='addToCart(${JSON.stringify(p)})'>🛒 أضف إلى السلة</button>
          </div>`;
        container.appendChild(div);
      }
    });
  });

function addToCart(product) {
  cart.push(product);
  showCart();
}

function showCart() {
  const cartBox = document.getElementById('cart');
  if (cart.length === 0) {
    cartBox.innerHTML = "السلة فارغة";
    return;
  }
  cartBox.innerHTML = cart.map(p => `<div class="cart-item">${p.name} - ${p.price} دج</div>`).join('') +
    `<p><strong>💰 المجموع: ${cart.reduce((s, p) => s + parseFloat(p.price), 0)} دج</strong></p>`;
}

// ولايات وبلديات
const dzData = {
  "تيارت": ["فرندة", "مهدية", "قصر الشلالة", "مدروسة"],
  "الجزائر": ["باب الزوار", "حيدرة", "بئر مراد رايس", "بلوزداد"],
  "وهران": ["السانية", "بئر الجير", "بطيوة", "الكرمة"]
};

const wilayaSelect = document.getElementById('wilaya');
const communeSelect = document.getElementById('commune');

for (let wilaya in dzData) {
  let option = document.createElement('option');
  option.value = wilaya;
  option.textContent = wilaya;
  wilayaSelect.appendChild(option);
}

wilayaSelect.addEventListener('change', () => {
  communeSelect.innerHTML = '<option value="">اختر البلدية</option>';
  const selected = dzData[wilayaSelect.value] || [];
  selected.forEach(commune => {
    let opt = document.createElement('option');
    opt.value = commune;
    opt.textContent = commune;
    communeSelect.appendChild(opt);
  });
});

document.getElementById('orderForm').addEventListener('submit', function(e) {
  if (cart.length === 0) {
    e.preventDefault();
    alert("❌ السلة فارغة!");
    return;
  }

  document.getElementById('cartData').value = cart.map(p => `${p.name} (${p.price} دج)`).join(" - ");
  document.getElementById('cartTotal').value = cart.reduce((s, p) => s + parseFloat(p.price), 0);
});
</script>

</body>
</html>
