<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù…ØªØ¬Ø±ÙŠ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠ</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f9f9f9; }
    .product { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; background: white; display: flex; gap: 15px; }
    .product img { width: 100px; height: 100px; object-fit: cover; }
    #cart, #orderForm { margin-top: 30px; }
  </style>
</head>
<body>

<h1>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h1>
<div id="products"></div>

<h2>ğŸ›’ Ø§Ù„Ø³Ù„Ø©</h2>
<div id="cart">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</div>

<h2>ğŸ“¦ ØªÙ†ÙÙŠØ° Ø§Ù„Ø·Ù„Ø¨</h2>
<form id="orderForm">
  <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„: <input type="text" name="name" required></label><br><br>
  <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ: <input type="tel" name="phone" required></label><br><br>
  <label>Ø§Ù„ÙˆÙ„Ø§ÙŠØ©:
    <select id="wilaya" name="wilaya" required>
      <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ„Ø§ÙŠØ©</option>
    </select>
  </label><br><br>
  <label>Ø§Ù„Ø¨Ù„Ø¯ÙŠØ©:
    <select id="commune" name="commune" required>
      <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù„Ø¯ÙŠØ©</option>
    </select>
  </label><br><br>
  <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ§Ù…Ù„: <input type="text" name="address" required></label><br><br>
  <button type="submit">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
</form>

<script>
const PRODUCTS_URL = "https://script.google.com/macros/s/AKfycbwAYiOFNt4eGtmSclHWBSJaMwMhSzois2-BP_uchEVhoBs7ga_CB67qi1uz_lGUgVay/exec";
const ORDER_URL = "https://script.google.com/macros/s/AKfycbyAQc09c0iyulqwRrEq-lLLi73SuqdttoZOAVuOmCu6lm7YSsAheyXd3vz0FvL0jqic/exec";

let cart = [];

// 1. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
fetch(PRODUCTS_URL)
  .then(res => res.json())
  .then(products => {
    const container = document.getElementById('products');
    products.forEach(p => {
      if (parseInt(p.quantity) > 0) {
        const div = document.createElement('div');
        div.className = 'product';
        div.innerHTML = `
          <img src="${p.image}" alt="${p.name}" />
          <div>
            <h3>${p.name}</h3>
            <p>${p.description}</p>
            <p><strong>${p.price} Ø¯Ø¬</strong></p>
            <button onclick='addToCart(${JSON.stringify(p)})'>Ø£Ø¶Ù Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©</button>
          </div>`;
        container.appendChild(div);
      }
    });
  });

// 2. Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©
function addToCart(product) {
  cart.push(product);
  showCart();
}

function showCart() {
  const cartBox = document.getElementById('cart');
  if (cart.length === 0) {
    cartBox.innerHTML = "Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©";
    return;
  }
  cartBox.innerHTML = cart.map(p => `<p>${p.name} - ${p.price} Ø¯Ø¬</p>`).join('') +
    `<p><strong>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${cart.reduce((s, p) => s + parseFloat(p.price), 0)} Ø¯Ø¬</strong></p>`;
}

// 3. ÙˆÙ„Ø§ÙŠØ§Øª ÙˆØ¨Ù„Ø¯ÙŠØ§Øª
const dzData = {
  "ØªÙŠØ§Ø±Øª": ["ÙØ±Ù†Ø¯Ø©", "Ù…Ù‡Ø¯ÙŠØ©", "Ù‚ØµØ± Ø§Ù„Ø´Ù„Ø§Ù„Ø©", "Ù…Ø¯Ø±ÙˆØ³Ø©"],
  "Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±": ["Ø¨Ø§Ø¨ Ø§Ù„Ø²ÙˆØ§Ø±", "Ø­ÙŠØ¯Ø±Ø©", "Ø¨Ø¦Ø± Ù…Ø±Ø§Ø¯ Ø±Ø§ÙŠØ³", "Ø¨Ù„ÙˆØ²Ø¯Ø§Ø¯"],
  "ÙˆÙ‡Ø±Ø§Ù†": ["Ø§Ù„Ø³Ø§Ù†ÙŠØ©", "Ø¨Ø¦Ø± Ø§Ù„Ø¬ÙŠØ±", "Ø¨Ø·ÙŠÙˆØ©", "Ø§Ù„ÙƒØ±Ù…Ø©"]
};

const wilayaSelect = document.getElementById('wilaya');
const communeSelect = document.getElementById('commune');

for (let wilaya in dzData) {
  let option = document.createElement('option');
  option.value = wilaya;
  option.textContent = wilaya;
  wilayaSelect.appendChild(option);
}

wilayaSelect.addEventListener('change', () => {
  communeSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù„Ø¯ÙŠØ©</option>';
  const selected = dzData[wilayaSelect.value] || [];
  selected.forEach(commune => {
    let opt = document.createElement('option');
    opt.value = commune;
    opt.textContent = commune;
    communeSelect.appendChild(opt);
  });
});

// 4. Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨
document.getElementById('orderForm').addEventListener('submit', function(e) {
  e.preventDefault();

  if (cart.length === 0) {
    alert("âŒ Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©!");
    return;
  }

  const formData = new FormData(this);
  const order = {
    name: formData.get('name'),
    phone: formData.get('phone'),
    wilaya: formData.get('wilaya'),
    commune: formData.get('commune'),
    address: formData.get('address'),
    cart: cart.map(p => `${p.name} (${p.price} Ø¯Ø¬)` ).join(" - "),
    total: cart.reduce((s, p) => s + parseFloat(p.price), 0)
  };

  fetch(ORDER_URL, {
    method: "POST",
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(order)
  })
  .then(res => res.text())
  .then(res => {
    alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­!");
    cart = [];
    showCart();
    document.getElementById('orderForm').reset();
    communeSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù„Ø¯ÙŠØ©</option>';
  })
  .catch(err => {
    console.error(err);
    alert("âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨!");
  });
});
</script>
</body>
</html>
